# 6th Asprova Programming Contest Local Tester

手元の環境でジャッジ・システムテストのシミュレーションを行うためのスクリプトです。自分のプログラムがどのくらいの得点を得られるかをテストできます。

ただし、実際のAtCoder上での採点とは異なる入力データを生成して使いますので、このスクリプトの実行結果と全く同じ結果がAtCoder上で出るわけではありません。


## 動作環境

以下の二つが動作する環境を用意してください。

 * C++ コンパイラ
 * bash

以下の環境で動作が確認できています。

 * Windows 10 + Git Bash
 * Windows 10 + Windows Subsystem for Linux (WSL)
 * macOS Catalina + GNU bash
 * Ubuntu 18.04 LTS + GNU bash

参考: Git for Windows (https://gitforwindows.org/) をインストールすると Git Bash が使えます。

## testset_generator.sh

テスト用の入力ファイルを自動生成するスクリプトです。パラメタを列挙したファイルを読み込み、テストケースを自動生成します。出力されるテストケースは実行するたびに変わります。

オプションとして以下のものが使えます。

 * judge:  30通りのパラメタでそれぞれ1個ずつテストケースを生成します。
 * test:   30通りのパラメタでそれぞれ10個ずつテストケースを生成します。
 * full:   30通りのパラメタについてシステムテストと同じ個数のテストケースを生成します。
 * -o:     テストケースを書き出すディレクトリを指定します。デフォルトは test です。
 * -f:     パラメタを列挙したファイルを指定します。デフォルトは testset_parameters.txt です。
 * -p:     出力するテストケースのファイル名の接頭辞を指定します。デフォルトは test です。
 * -g:     テストケース生成コマンドを指定します。デフォルトは ./testcase_generator です。testcase_generator.cpp をコンパイルしてできる実行ファイルを想定しています。

full を指定した場合の出力ファイルサイズは合計 200MB 程度になります。


## testset_parameters.txt 

コンテスト中のジャッジと同じ個数（30個）のテストケースを生成するためのパラメタ記述ファイルです。編集してテストケース数を変えることができます。

各行は

```
<テストケース数>,<コマンドラインオプション>
```

の形式になっています。このフォーマットにマッチしない行は読み飛ばされます。また、テストケース数は ./testset_generator.sh へのコマンドライン引数による指定 (judge/test/full) がない場合のみ使用されます。


## local_tester.sh

自分のプログラムをテストケースに対してまとめて実行し、出力と採点結果の一覧を summary.csv に書き出すスクリプトです。

事前に output_checker.cpp を修正してコンパイルする必要がありますので、以下の「テスト実行の流れの一例」も参照してください。

summary.csv の各カラムは左から順に「入力ファイル名」「粗利」「納期遅れペナルティ」「電力コスト」「段取りコスト」「得点」です。また、最後のカラムには出力が不正のとき 'WA' が、実行時エラーが発生したとき 'RE' が書き込まれます。

出力結果が制約を満たしていないケースはすべての数値が 0 になります。また、解答プログラムの実行が正常に終了しなかった場合には結果が正しいフォーマットで出力されない可能性があります。

オプションとして以下のものが使えます。

 * -i:   使用するテストケースを格納したディレクトリを指定します。デフォルトは test です。このディレクトリ内にある .txt で終わる名前のファイルがすべてテストケースとみなされます。
 * -o:   実行結果を書き出すディレクトリを指定します。デフォルトはスクリプトの実行日時です。プログラムの出力は各入力と同じ名前のファイルに書き込まれます。
 * -e:   解答プログラムを実行するためのコマンドを指定します。デフォルトは ./a.out または ./a.exe です。コマンドが引数を伴う場合は二重引用符で囲んで下さい。(例: "python3 main.py")
 * -c:   output_checker.cpp をコンパイルしてできる実行ファイルを指定します。デフォルトは ./output_checker です。


## テスト実行の流れの一例

**注意: ファイル名が `-` で始まっていたり空白を含んでいたりすると正しく動きません**

1. testcase_generator.cpp と output_checker.cpp をそれぞれコンパイルします。output_checker.cpp は4行目
   ```
   // #define LOCAL_TEST
   ```
   のコメントを外して
   ```
   #define LOCAL_TEST
   ```
   としてからコンパイルしてください。GCC の場合は以下のコマンドでコンパイルできます。
   ```
   g++ -std=c++14 -o testcase_generator testcase_generator.cpp
   g++ -std=c++14 -o output_checker output_checker.cpp
   ```

2. 以下のものを同じディレクトリに置きます。
   - 1.でできた実行ファイル
   - testset_generator.sh
   - testset_parameters.txt
   - local_tester.sh
   - 解答プログラムの実行ファイル（ファイル名は a.out としておきます）

3. ./testset_generator.sh を実行します（出力先などを聞いてきますが、入力せずに Enter を押してもかまいません）。30個のテストケースが生成され、test/ 以下に保存されます。なお、ここまでの手順は二回目以降は実行する必要ありません。

4. ./local_tester.sh を実行します（出力先などを聞いてきますが、入力せずに Enter を押してもかまいません）。3. で生成されたテストケースに対してプログラムが実行されます。その出力および採点結果の csv ファイルが、実行日時を名前とするディレクトリに保存されます。

解答プログラムが無限ループするなどして終了しない場合はスクリプトの実行もそこで止まってしまいます。スクリプト実行時に別ウィンドウが開いている場合、Ctrl+C で実行中のテストケースを強制終了、ウィンドウを閉じるとスクリプト全体の実行を終了させられるようです。
